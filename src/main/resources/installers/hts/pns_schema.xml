<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet failOnError="true" author="Taiwo Gboyegun" id="20240405-002">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="hts_pns_index_client_partner"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE hts_pns_index_client_partner
            (
                id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                uuid character varying NOT NULL,
                dob date,
                is_date_of_birth_estimated boolean,
                facility_id bigint NOT NULL,
                sex character varying,
                address character varying ,
                phone_number character varying,
                alternate_phone_number character varying,
                last_name character varying ,
                first_name character varying ,
                middle_name character varying ,
                notification_method character varying(200),
                hts_client_uuid character varying,
                intermediate_partner_violence jsonb,
                relationship_with_index_client character varying(200),
                known_hiv_positive character varying(200),
                date_partner_tested date,
                hiv_test_result character varying(200),
                archived integer NOT NULL,
                date_enrollment_on_art date,
                hts_client_information jsonb,
                contact_tracing jsonb,
                index_client_id character varying,
                accepted_pns character varying,
                offered_pns character varying,
                accepted_hts character varying,
                date_created timestamp without time zone NOT NULL,
                created_by character varying NOT NULL,
                date_modified timestamp without time zone NOT NULL,
                modified_by character varying NOT NULL,
                CONSTRAINT hts_pns_index_client_partner_pkey PRIMARY KEY (id),
                CONSTRAINT hts_client_uuid_fk FOREIGN KEY (hts_client_uuid)
                    REFERENCES hts_client (uuid) MATCH SIMPLE
                    ON UPDATE NO ACTION
                    ON DELETE NO ACTION
                    NOT VALID
            )
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20240405-003" author="Taiwo Gboyegun">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="hts_client" columnName="offered_pns" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE hts_client ADD offered_pns character varying;
        </sql>
        <sql>
            ALTER TABLE hts_client ADD accepted_pns character varying;
        </sql>
    </changeSet>
</databaseChangeLog>